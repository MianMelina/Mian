
Private Sub UserForm_Initialize()
    On Error GoTo ErrorHandler
    
    Dim baseFolderPath As String
    Dim subFolderNames() As String
    Dim subFolderName As String
    Dim subFolderPath As String
    Dim newestFile As String
    Dim i As Integer

    ' Initialisierung
    baseFolderPath = "C:\TEST\1234567\Test\01 Fahrzeugverwaltung\Pool 2024\" ' Basisordner angeben
    subFolderNames = Split("01 Januar,02 Februar,03 März,04 April,05 Mai,06 Juni,07 Juli,08 August,09 September,10 Oktober,11 November,12 Dezember", ",")
    
    ' Bildschirmaktualisierung und Berechnung deaktivieren
    Application.ScreenUpdating = False
    Application.Calculation = xlCalculationManual
    
    ' Schleife durch alle angegebenen Unterordnernamen
    For i = LBound(subFolderNames) To UBound(subFolderNames)
        subFolderName = subFolderNames(i)
        subFolderPath = baseFolderPath & subFolderName
        
        ' Holen des neuesten PDF-Dateinamens
        newestFile = GetNewestPdfFileUsingDir(subFolderPath)
        
        ' Füge den Dateinamen oder die Fehlermeldung zur ListBox hinzu
        If newestFile <> "" Then
            Me.Controls("ListBox" & i + 1).AddItem newestFile
        Else
            Me.Controls("ListBox" & i + 1).AddItem "Keine PDF-Dateien gefunden oder Ordner nicht gefunden"
        End If
    Next i
    
    ' Bildschirmaktualisierung und Berechnung wieder aktivieren
    Application.ScreenUpdating = True
    Application.Calculation = xlCalculationAutomatic

    Exit Sub

ErrorHandler:
    ' Fehlerbehandlung
    MsgBox "Ein Fehler ist aufgetreten: " & Err.Description
    Application.ScreenUpdating = True
    Application.Calculation = xlCalculationAutomatic
End Sub

Private Function GetNewestPdfFileUsingDir(folderPath As String) As String
    On Error GoTo ErrorHandler
    
    Dim fileName As String
    Dim fileDate As Date
    Dim latestDate As Date
    Dim newestFile As String
    
    latestDate = 0
    newestFile = ""
    
    ' Verwende Dir, um durch die Dateien zu schleifen
    fileName = Dir(folderPath & "\*.pdf")
    
    Do While fileName <> ""
        fileDate = FileDateTime(folderPath & "\" & fileName)
        If fileDate > latestDate Then
            latestDate = fileDate
            newestFile = fileName
        End If
        fileName = Dir
    Loop
    
    GetNewestPdfFileUsingDir = newestFile
    Exit Function
    
ErrorHandler:
    GetNewestPdfFileUsingDir = ""
End Function
