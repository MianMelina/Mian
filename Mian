
Private Sub UserForm_Initialize()
    Dim baseFolderPath As String
    Dim subFolderNames() As String
    Dim subFolderName As String
    Dim subFolderPath As String
    Dim newestFile As String
    Dim i As Integer

    ' Initialisierung
    baseFolderPath = "C:\TEST\1234567\Test\01 Fahrzeugverwaltung\Pool 2024\" ' Basisordner angeben
    subFolderNames = Split("01 Januar,02 Februar,03 März,04 April,05 Mai,06 Juni,07 Juli,08 August,09 September,10 Oktober,11 November,12 Dezember", ",")

    ' Bildschirmaktualisierung und Berechnung deaktivieren
    Application.ScreenUpdating = False
    Application.Calculation = xlCalculationManual

    ' Schleife durch alle angegebenen Unterordnernamen
    For i = LBound(subFolderNames) To UBound(subFolderNames)
        subFolderName = subFolderNames(i)
        subFolderPath = baseFolderPath & subFolderName

        ' Holen des neuesten PDF-Dateinamens
        newestFile = GetNewestPdfFile(subFolderPath)
        
        ' Füge den Dateinamen oder die Fehlermeldung zur ListBox hinzu
        If newestFile <> "" Then
            Me.Controls("ListBox" & i + 1).AddItem newestFile
        Else
            Me.Controls("ListBox" & i + 1).AddItem "Keine PDF-Dateien gefunden oder Ordner nicht gefunden"
        End If
    Next i

    ' Bildschirmaktualisierung und Berechnung wieder aktivieren
    Application.ScreenUpdating = True
    Application.Calculation = xlCalculationAutomatic
End Sub

Private Function GetNewestPdfFile(folderPath As String) As String
    Dim fso As Object
    Dim folder As Object
    Dim file As Object
    Dim latestDate As Date
    Dim newestFile As String

    On Error GoTo ErrorHandler
    Set fso = CreateObject("Scripting.FileSystemObject")
    
    ' Überprüfe, ob der Ordner existiert
    If fso.FolderExists(folderPath) Then
        Set folder = fso.GetFolder(folderPath)
        latestDate = 0
        
        ' Schleife durch alle Dateien im Ordner
        For Each file In folder.Files
            If LCase(fso.GetExtensionName(file.Name)) = "pdf" Then
                If file.DateLastModified > latestDate Then
                    latestDate = file.DateLastModified
                    newestFile = file.Name
                End If
            End If
        Next file
    End If

    GetNewestPdfFile = newestFile

Cleanup:
    Set fso = Nothing
    Set folder = Nothing
    Set file = Nothing
    Exit Function

ErrorHandler:
    GetNewestPdfFile = ""
    Resume Cleanup
End Function
